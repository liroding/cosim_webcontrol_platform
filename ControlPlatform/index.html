<!doctype html>
<html lang="us">
<head>
	<meta charset="utf-8">
	<title>COSIM PLATFORM </title>
	<link href="css/jquery-ui.css" rel="stylesheet">
	<link href="css/jquery-ui.min.css" rel="stylesheet">
	<style>
	body{
		font-family: "Trebuchet MS", sans-serif;
		margin: 50px;
	}
	.demoHeaders {
		margin-top: 2em;
	}
	#dialog-link {
		padding: .4em 1em .4em 20px;
		text-decoration: none;
		position: relative;
	}
	#dialog-link span.ui-icon {
		margin: 0 5px 0 0;
		position: absolute;
		left: .2em;
		top: 50%;
		margin-top: -8px;
	}
	#icons {
		margin: 0;
		padding: 0;
	}
	#icons li {
		margin: 2px;
		position: relative;
		padding: 4px 0;
		cursor: pointer;
		float: left;
		list-style: none;
	}
	#icons span.ui-icon {
		float: left;
		margin: 0 4px;
	}
	.fakewindowcontain .ui-widget-overlay {
		position: absolute;
	}
	select {
		width: 200px;
	}

	.comments {
	 width:100%;/*自动适应父布局宽度*/
	 overflow:auto;
	 word-break:break-all;
	 height:100px;
	 
	}

	</style>
</head>
<body>




<h1>-------- COSIM PlatForm -------</h1>

<div class="ui-widget">
	<p>简单介绍平台可以实现的功能</p>
</div>




<!-- Accordion -->
<h2 class="demoHeaders">模块介绍</h2>
<div id="accordion">
	<h3>App </h3>

	<div>
	         <pre>
	         <text id ="introduction_app" >Introduction</text>
		 </pre>
		
        </div>
	<h3>Qemu </h3>
	<div>  
		<pre>
		<text id ="introduction_qemu">Introduction</text>
		</pre>
	</div>
	<h3>Dut </h3>
	<div>
		<pre>
		<text id ="introduction_dut">Introduction</text>
		</pre>
        </div>

</div>




<!-- Controlgroup -->
<h2 class="demoHeaders">操作台</h2>
<fieldset>
	<legend>控制面板</legend>
	<div id="controlpanel">
		<ui>
		<a href="#title_connectwebserver">链接服务器</a>
		<a href="#title_checkcfgarg">查看平台参数配置</a>
		<a href="#title_controlgroup">启动终端模块</a>
		<a href="#connectwebserver">查看log</a>
		<a href="#title_recordinfo">个人记录</a>
		</ui>

	</div>
</fieldset>



<!-- build link with webserver -->
<h2 id="title_connectwebserver" class="demoHeaders">链接web服务</h2>
<div id="connectwebserver">
    
    <p><label for="ipaddr">Server HostName：</label><input id="hostname" title="Input host name" autocomplete="off" disabled="disabled" ></p>
    <p><label for="ipaddr">Server IPAddr：</label><input id="ip" title="Input Ip Address" autocomplete="off" disabled="disabled"></p>
	<p><label for="port">  Server Port：</label><input id="port" title="Input Port Value" autocomplete="off" disabled="disabled"></p>
    <!--
    <p><label for="ipaddr">Server IPAddr：</label><input id="ip" title="Input Ip Address" ></p>
	<p><label for="port">  Server Port：</label><input id="port" title="Input Port Value" ></p>
    -->
    
    <button id="btn_openlink">Connect Server</button>
	<button id="btn_closelink">Close Connect </button> </br>
	
</div>


<!-- Tabs -->
<h2 id="title_checkcfgarg" class="demoHeaders">查看配置状态</h2>

<div id="checkcfgarg" style ="color: #00ff00;height:300px;width:800px;overflow:auto;">
	<ul>
		<li><a href="#12" id='href_app'>APP CFG</a></li>
		<li><a href="#32" id='href_qemu'>QEMU CFG</a></li>
		<li><a href="#tabs-3">DUT CFG</a></li>
		<li><a href="#tabs-3">一键查看</a></li>
		<li><a href="#2" id='href_submit'>更新数据</a></li> 

	</ul>

    <div>
        <text id ="checkcfgarg_showInfo"></text>
    </div>

</div>



<!-- Controlgroup -->
<h2 id= "title_controlgroup" class="demoHeaders">操作台</h2>
<fieldset>
	<legend>控制面板</legend>
	<div id="controlgroup">
		<select id="car-type">
			<option>一般操作</option>
			<option>特殊操作</option>

		</select>

		<button id="btn_runscreen">Run Screen</button>
		<button id="btn_runqemu">Run Qemu</button>
		<button id="btn_rundut">Run Dut</button>

	</div>
</fieldset>




<!-- Tooltip 
<h2 class="demoHeaders">Tooltip</h2>
<p id="tooltip">
	<a href="#" title="That&apos;s what this widget is">Tooltips</a> can be attached to any element. When you hover
the element with your mouse, the title attribute is displayed in a little box next to the element, just like a native tooltip.
</p>
-->


<!-- Highlight / Error -->
<h2 class="demoHeaders">Highlight / Error</h2>
<div class="ui-widget">
	<div class="ui-state-highlight ui-corner-all" style="margin-top: 20px; padding: 0 .7em;">
		<p><span class="ui-icon ui-icon-info" style="float: left; margin-right: .3em;"></span>
		<strong>Hey!</strong> Sample ui-state-highlight style.</p>
	</div>
</div>
<br>
<div class="ui-widget">
	<div class="ui-state-error ui-corner-all" style="padding: 0 .7em;">
		<p><span class="ui-icon ui-icon-alert" style="float: left; margin-right: .3em;"></span>
		<strong>Alert:</strong> Sample ui-state-error style.</p>
	</div>
</div>



<!-- record self info -->
<h2 id="title_recordinfo" class="demoHeaders">Record INFO</h2>

<fieldset>
	<legend>INFO</legend>

	<div id = "div_infoshow" >
		 
      		<textarea class="comments" id="infoshow" readonly="true" style="width:200px; height:100px">

      		</textarea>
     		<button id="btn_showinfo">showinfo</button>
	</div>

	<br>

	Input Info: <input type="text" id="inputinfo" />
	<button id="btn_addinfo">addinfo</button>

	
</fieldset>




<!-- GET LOG-->
<h2 class="demoHeaders">Get Log</h2>
<button id="btn_getlog">获取外部内容</button>




<!---------------------- JS Func ------------------->

<script src="external/jquery.js"></script>
<script src="js/jquery-ui.js"></script>
<script src="js/jquery-ui.min.js"></script>
<script src="js/edit.js"></script>

<script>

$( "#accordion" ).accordion();


$( "#button" ).button();


//-----------------------------------introduction-----------------------------------------------/
$(document).ready(function(){
	$("#introduction_app").load('cosim/introduction/app.txt');
	$("#introduction_qemu").load('cosim/introduction/qemu.txt');
	$("#introduction_dut").load('cosim/introduction/dut.txt');

	$("#introduction_app").css('font-size',15);
	$("#introduction_qemu").css('font-size',15);
	$("#introduction_dut").css('font-size',15);
});



//---------------------------startup screen/qemu/dut func--------------------------------------------/
$("#btn_runscreen").click(function(){
            
        alert("数据: run screen");
            if (serverip == null){
		alert('ip is null,please connect the server');
		return ;
	    } 
	    console.log('startup screen ..... ');
	   
	    gurl = "http://" + serverip + ":" + serverport + "/runscreen";
	    alert(gurl);


	    //send post request

	    $.post(gurl,
	    {
		type:"runscreen"
	       
	    },
	    function(data,status){
		console.log("数据: \n" + data + "\n状态: " + status);
		$("#btn_runscreen").text("screen open");
	    });

	

});

$("#btn_runqemu").click(function(){

       	    alert("数据: run qemu");
            if (serverip == null){
		alert('ip is null,please connect the server');
		return ;
	    } 
	    console.log('startup qemu ..... ');
	   
	    gurl = "http://" + serverip + ":" + serverport + "/runqemu";
	    alert(gurl);


	    //send post request

	    $.post(gurl,
	    {
		type:"runqemu"
	       
	    },
	    function(data,status){
		console.log("数据: \n" + data + "\n状态: " + status);
		$("#btn_runqemu").text("qemu open");
	    });

});

$("#btn_rundut").click(function(){

       	    alert("数据: run dut");
            if (serverip == null){
		alert('ip is null,please connect the server');
		return ;
	    } 
	    console.log('startup dut ..... ');
	   
	    gurl = "http://" + serverip + ":" + serverport + "/rundut";
	    alert(gurl);


	    //send post request

	    $.post(gurl,
	    {
		type:"rundut"
	       
	    },
	    function(data,status){
		console.log("数据: \n" + data + "\n状态: " + status);
		$("#btn_runqemu").text("dut open");
	    });


});



//------------------------------------------------------------------/

$( "#controlgroup" ).controlgroup();

$("#connectwebserver").tabs();

$(function() {
    $( "#checkcfgarg" ).tabs({
      collapsible: true
	  
    });
});



$( "#tooltip" ).tooltip();


//////////////////////////////////////////////////////////


$(document).ready(function(){
       //alert("weclome ------ ");

}) ;


$(document).ready(function(){
	$("#btn_getlog").click(function(){

	alert('nihao');
    $.post("http://127.0.1.1:8888",
    {
        name:"nihao",
		age:18
       
    },
    function(data,status){
        alert("数据: \n" + data + "\n状态: " + status);
    });


	});
});


$(document).ready(function(){

  $("#controlpanel").controlgroup();
});




//-----------------------------------------------------------------/
var gdatajson; 
var gurl = "";
var gurlupdate = "";    //update the cfg.ini file base this url 

var serverip = null; //ipaddress
var serverport = null; //port


function Modify(btn) {
		
        	var modify = btn.value == '修改'
        	var tr = btn.parentNode.parentNode;
	

        	if (modify) {
			 
           		 tr.cells[1].innerHTML = '<input type="text" value="' + tr.cells[1].innerHTML.replace(/"/g, '&quot;') + '"/>'
	     
        	}
        	else {
 					
                 tr.cells[1].innerHTML = tr.cells[1].firstChild.value.replace(/</g, '&lt;').replace(/>/g, '&gt;')
	
        	}
			//alert('[LIRO-DEBUG] row = '  + tr.rowIndex);
			//alert('[LIRO-DEBUG] row = '  + tr.cells[0].innerText);
			//alert('[LIRO-DEBUG] value = ' + tr.cells[1].innerText);
			
        	btn.value=modify?'更新':'修改'
		
}


function creatTab(datajson,tab){
    console.log("creattab");

    var rows = 0;
	var tmptab = tab;
	
    objnum = Object.keys(datajson).length;
	
	console.log(objnum);
        		
    for(var i=0;i<objnum;i++){
	            tmptab+='<tr>'
	            for(var key in datajson[i]){
	            	    tmptab +="<td style='background:green' >"+ key +"</td>"
						tmptab +="<td style='background:green' >"+ datajson[i][key] +"</td>"
						tmptab += '<td><input type="button" value="修改" onclick="Modify(this)" /></td>'
						tmptab += "<td style='background:green'>"  + "<p title="+ datajson[i][key] + ">?</p>" + "</td></tr>"
	            		tmptab +='</tr>'
				    
	            }
      }  
				
    tmptab+='</table>';

	return tmptab;
	
};



function updatejsondata(){  //update the json data
	var tb = document.getElementById('cfgtable');    // table 的 id
	objnum = Object.keys(gdatajson).length;  
	var rows = tb.rows;                           // 获取表格所有行
		for(var i = 0; i<rows.length ; i++ ){
   				for(var j = 0; j< 1; j++ ){    
					for(var x=0;x<objnum;x++){
						for(var key in gdatajson[x]){  //
							if(rows[i].cells[j].innerHTML==key){
								//alert('==')
								gdatajson[x][key] = rows[i].cells[j+1].innerHTML
								break
							}
						}
					}
   				}
		}
}



function submit(tmpgurl){

	alert('update data')
	updatejsondata();
	var url = tmpgurl;   //app cfg submit
	var httpRequest = new XMLHttpRequest();
	httpRequest.open('POST', url, true); 
	httpRequest.setRequestHeader("Content-type", "multipart/form-data");
	//httpRequest.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
	
	httpRequest.send(JSON.stringify(gdatajson))
}


$("#href_submit").click(function(){
	console.log('href submit');
	gurlupdate = gurl + "/update";
	
        console.log(gurlupdate);
	submit(gurlupdate);
});

//-----------------------------------------------------------------//
$("#href_app").click(function(){
    if (serverip == null){
        alert('ip is null,please connect the server');
	return;
    }
    console.log('href app ');
    alert(serverport); 
//    gurl = "http://127.0.1.1:8888/cosim/cfgini/app.ini";
   
    gurl = "http://" + serverip + ":" + serverport + "/cosim/cfgini/app.ini";
    alert(gurl);

    var tab='<table id="cfgtable" border=1 width=500">'

	//send post request

    $.post(gurl,
    {
        type:"app"
       
    },
    function(data,status){
        console.log("数据: \n" + data + "\n状态: " + status);
		
		var jsonstr = data;
		gdatajson = JSON.parse(jsonstr);

		console.log(jsonstr)

	    varnewtab = creatTab(gdatajson,tab);

		console.log(varnewtab)
		
		$("#checkcfgarg_showInfo").text("");
		$("#checkcfgarg_showInfo").html(varnewtab);
		
    });
    
});
$("#href_qemu").click(function(){
   
    if (serverip == null){
        alert('ip is null,please connect the server');
	return ;
    }
    console.log('href qemu ');
    alert(serverport); 
   
    gurl = "http://" + serverip + ":" + serverport + "/cosim/cfgini/qemu.ini";
  
    alert(gurl)
    
    var tab='<table id="cfgtable" border=1 width=500">'
    
	//send post request

    $.post(gurl,
    {
        type:"qemu"
    },
    function(data,status){
                console.log("数据: \n" + data + "\n状态: " + status);
		
		var jsonstr = data;
		gdatajson = JSON.parse(jsonstr);

		console.log(jsonstr)

	        varnewtab = creatTab(gdatajson,tab);

		console.log(varnewtab)
		
		$("#checkcfgarg_showInfo").text("");
		$("#checkcfgarg_showInfo").html(varnewtab);
		
    });
    
});

//---------------------------ipaddr port func--------------------------------------------/
$("#btn_openlink").click(function(){
                
//    serverinipath = "cosim/cfgini/server.ini";
    

    $.getJSON("webserver/cfg/server.json",function(data)	{
                        alert('connect server .....');
		        $.each(data,function(i,field){
                        if (i == 'ip'){
                            $("#ip").val(field);
                            serverip = field;
                        }else if(i == 'port'){
                            $("#port").val(field);
                            serverport = field; 
                        }else if(i == 'hostname'){
                            $("#hostname").val(field);
                        
                        }

					})
         })
});

$("#btn_closelink").click(function(){
                

    if (serverip == null){
        alert('ip is null,please connect the server');
	return ;
    } 
    console.log('close server connect ..... ');
   
    gurl = "http://" + serverip + ":" + serverport + "/closeserver";
    alert(gurl);


	//send post request

    $.post(gurl,
    {
        type:"closeserver"
       
    },
    function(data,status){
        console.log("数据: \n" + data + "\n状态: " + status);
		
    });

    //window.location.reload();



});

//--------------------------show pic func-----------------------------------------/


//------------------------------check server link status----------------------------------------------------/

function serverlinkstatus(){

    if (serverip == null){
	alert('ip is null,please connect the server');
	return;
    }
    
    console.log('check server link status ..... ');
   
    gurl = "http://" + serverip + ":" + serverport + "/checkserverstatus";
   // alert(gurl);


	//send post request

    $.post(gurl,
    {
        type:"serverstatus"
       
    },
    function(data,status){
    	
        console.log("数据: \n" + data + "\n状态: " + status);
        //alert("数据: \n" + data + "\n状态: " + status);
		
    }).error(function(xhr,errorText,errorType){
    	alert('The server is disconnected !!!');

	});;


}

//setInterval("serverlinkstatus()",10000);

//----------------------------------Info record-------------------------------------------------/



$(document).ready(function(){


  $("#btn_showinfo").click(function(){
      $("#infoshow").val('');
      $("#infoshow").load('cosim/Record/note.txt',function(ResponseText,Status,xhr){
	if(Status == "success")
		console.log("数据: \n" + ResponseText + "\n状态: " + Status);
	
     		$("#infoshow").val(ResponseText);
	});

  });


  $("#btn_addinfo").click(function(){

	var ele = document.getElementById("infoshow");
	var inputvalue = $("#inputinfo").val();
	alert(inputvalue);

	if (inputvalue.length >0){
	
                    ele.value = ele.value + "\n" + inputvalue;

   		    if (serverip == null){
		          alert('ip is null,please connect the server');
			  return ;
		    }
			   
		    gurl = "http://" + serverip + ":" + serverport + "/updateinfo";
		 //   alert(gurl);

			//send post request

		    $.post(gurl,
		    {
			type:"addinfo",
			data:inputvalue
		       
		    },
		    function(data,status){
			console.log("数据: \n" + data + "\n状态: " + status);
		
		    });





	}
	
      
  });
  
});
//-----------------------------------------------------------------------------------/
</script>


</body>
</html>
